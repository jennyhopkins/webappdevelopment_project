<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Projects</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Crimson+Text&display=swap" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="/css/main.css">
    <link rel="stylesheet" type="text/css" href="/css/projects.css">
    <script src="script/config.js"></script>
</head>
<body>
<main>
    <header>
        <img id="logo" src="content/resources/J_logo.png" alt="Jenny's logo"/>
        <h1>&nbsp; &nbsp; &nbsp; Jenny Hopkins</h1>
    </header>
    <div class="topnav">
        <a href="home_page.html">Home</a>
        <a href="photos_page.html">Photos</a>
        <a class="active" href="projects.html">Projects</a>
        <a href="contact.html">Contact Me</a>
    </div>
    <section id="currentWeatherAPI">
        <p>Here is a project which pulls weather and weather-related data using OpenWeather API keys. Feel free to use
            the searches below. <br>
        </p>
        <section id="currentWeather">
            <form class="center">
                <p>Search for the current weather in any US city by "city" or "city, state" e.g. "Houston" or "Boston,
                    MA":</p>
                <input type="text" id="city1" size="50" name="city">
                <input type="button" id=button1 onclick="searchCurrentWeather()" value="Search"><br>
            </form>
        </section>
        <div style="text-align: center">
            <h3 id="desc"></h3>
            <h3 id="temp"></h3>
            <h3 id="feels_like"></h3>
            <h3 id="temp_min"></h3>
            <h3 id="temp_max"></h3>
        </div>
    </section>
    <hr class="vertical-line"></hr>
    <section id="dailyWeatherAPI">
        <section>
            <section id="dailyWeather">
                <form class="center">
                    <p>Search for daily weather by latitude and longitude: </p>
                    <p>Latitude: <input type="text" id="lat1" size="25" name="lat"></p>
                    <p> Longitude: <input type="text" id="long1" size="25" name="long"></p>
                    <input type="button" id=button2 onclick="searchDailyWeather()" value="Search"><br>
                </form>
            </section>
        </section>
        <h3 id="timezone"></h3>
        <h3 id="todayDayTemp"></h3>
        <h3 id="todayEveTemp"></h3>
        <h3 id="todayMinTemp"></h3>
        <h3 id="todayMaxTemp"></h3>
        <h3 id="todayWindSpeed"></h3>
        <h3 id="alerts"></h3>
    </section>
    <hr class="vertical-line"></hr>
    <section id="airPollutionAPI">
        <section>
            <section id="airPollution">
                <form class="center">
                    <p>Search for air pollution by latitude and longitude: </p>
                    <p>Latitude: <input type="text" id="lat2" size="25" name="lat"></p>
                    <p> Longitude: <input type="text" id="long2" size="25" name="long"></p>
                    <input type="button" id=button3 onclick="searchAirPollution()" value="Search"><br>
                </form>
            </section>
        </section>
        <h3 id="aqi"></h3>
        <h3 id="co"></h3>
        <h3 id="no"></h3>
        <h3 id="ozone"></h3>
    </section>
    <hr class="vertical-line"></hr>
    <section id="weatherForecastByZipcodeAPI">
        <section>
            <section id="weatherForecast">
                <form class="center">
                    <p>Search for weather forecast by zipcode: </p>
                    <input type="text" id="zipcode" size="10" name="zipcode">
                    <input type="button" id=button4 onclick="searchWeatherForecastByZipcode()" value="Search"><br>
                </form>
            </section>
        </section>
        <div id="forecastResults">
            <div id="forecast3">
                <h3 id="predictionTime1"></h3>
                <h3 id="predictionTemp1"></h3>
                <h3 id="predictionDescription1"></h3>
            </div>
        </div>
    </section>
    <hr class="vertical-line"></hr>
</main>
<footer id="footer">
    Copyright Jenny Hopkins 2021, CS 601 Web App Development
</footer>
<script>
    class Forecast {
        constructor(predictionTime, predictionTemp, predictionDescription) {
            this._predictionTime = predictionTime;
            this._predictionTemp = predictionTemp;
            this._predictionDescription = predictionDescription;
        }

        //Getter
        get predictionTime() {
            return this._predictionTime;
        }

        get predictionTemp() {
            return this._predictionTemp;
        }

        get predictionDescription() {
            return this._predictionDescription;
        }
    }

    function convertKelvinToFahrenheit(Kelvin) {
        let Fahrenheit = ((Kelvin - 273.15) * 9 / 5) + 32;
        return Fahrenheit;
    }

    function searchCurrentWeather() {
        var city = document.getElementById("city1").value;
        console.log("city entered: ", city);

        var myHeaders = new Headers();
        myHeaders.append('Access-Control-Allow-Origin', '');
        myHeaders.append("Accept", "/");

        var requestOptions = {
            method: 'GET',
            mode: 'cors',
            cache: 'no-cache',
            redirect: 'follow',
            referrerPolicy: 'no-referrer',
        };

        //securely read API key
        let url = "http://localhost:8010/proxy/data/2.5/weather?q=" + city + ",us&appid=" + config.apiKey;

        fetch(url, requestOptions)
            .then(response => response.text())
            .then(result => parseCurrentWeatherOutput(result))
            .catch(error => console.log('error', error));
    }

    function parseCurrentWeatherOutput(input) {
        const output = JSON.parse(input);
        console.log(output);
        let desc = output.weather[0].description; //weather info is in array
        console.log("weather" + desc);
        document.getElementById("desc").innerHTML = "Weather description: " + desc;
        let temp = Math.round(convertKelvinToFahrenheit(output.main.temp));
        document.getElementById("temp").innerHTML = "Temperature: " + temp + " F";
        let feels_like = Math.round(convertKelvinToFahrenheit(output.main.feels_like));
        document.getElementById("feels_like").innerHTML = "Feels like: " + feels_like + " F";
        console.log("feels_like: " + feels_like);
        let temp_min = Math.round(convertKelvinToFahrenheit(output.main.temp_min));
        document.getElementById("temp_min").innerHTML = "Min Temperature: " + temp_min + " F";
        let temp_max = Math.round(convertKelvinToFahrenheit(output.main.temp_max));
        document.getElementById("temp_max").innerHTML = "Max Temperature: " + temp_max + " F";
    }

    function searchDailyWeather() {
        var lat1 = document.getElementById("lat1").value;
        var long1 = document.getElementById("long1").value;

        var myHeaders = new Headers();
        myHeaders.append('Access-Control-Allow-Origin', '');
        myHeaders.append("Accept", "/");

        var requestOptions = {
            method: 'GET',
            mode: 'cors',
            cache: 'no-cache',
            redirect: 'follow',
            referrerPolicy: 'no-referrer',
        };

        // let url = "http://localhost:8010/proxy/data/2.5/onecall?lat=33.44&lon=-94.04&exclude=minutely,hourly,current&appid=" + config.apiKey;
        let url = "http://localhost:8010/proxy/data/2.5/onecall?lat=" + lat1 + "&lon=" + long1 + "&exclude=minutely,hourly,current&appid=" + config.apiKey;
        fetch(url, requestOptions)
            .then(response => response.text())
            .then(result => parseDailyWeatherOutput(result))
            .catch(error => console.log('error', error));
    }

    function parseDailyWeatherOutput(input) {
        const output = JSON.parse(input);
        console.log(output);
        let timezone = output.timezone;
        document.getElementById("timezone").innerHTML = "Timezone: " + timezone;
        let todayDayTemp = Math.round(convertKelvinToFahrenheit(output.daily[0].temp.day));
        console.log("today day temp: " + todayDayTemp);
        document.getElementById("todayDayTemp").innerHTML = "Today's day temperature: " + todayDayTemp + " F";
        let todayEveTemp = Math.round(convertKelvinToFahrenheit(output.daily[0].temp.eve));
        console.log("today eve temp: " + todayEveTemp);
        document.getElementById("todayEveTemp").innerHTML = "Today's evening temperature: " + todayEveTemp + " F";
        let todayMinTemp = Math.round(convertKelvinToFahrenheit(output.daily[0].temp.min));
        console.log("today min temp: " + todayMinTemp);
        document.getElementById("todayMinTemp").innerHTML = "Today's min temperature: " + todayMinTemp + " F";
        let todayMaxTemp = Math.round(convertKelvinToFahrenheit(output.daily[0].temp.max));
        console.log("today max temp: " + todayMaxTemp);
        document.getElementById("todayMaxTemp").innerHTML = "Today's max temperature: " + todayMaxTemp + " F";
        let todayWindSpeed = output.daily[0].wind_speed;
        document.getElementById("todayWindSpeed").innerHTML = "Today's wind speed: " + todayWindSpeed + " m/sec";
        let alerts = output.alerts;
        if (alerts != undefined) {
            document.getElementById("alerts").innerHTML = "Weather alerts: " + alerts;
        }
    }

    function searchAirPollution() {
        let lat2 = document.getElementById("lat2").value;
        let long2 = document.getElementById("long2").value;

        let myHeaders = new Headers();
        myHeaders.append('Access-Control-Allow-Origin', '');
        myHeaders.append("Accept", "/");

        let requestOptions = {
            method: 'GET',
            mode: 'cors',
            cache: 'no-cache',
            redirect: 'follow',
            referrerPolicy: 'no-referrer',
        };

        //let url = "http://localhost:8010/proxy/data/2.5/air_pollution?lat=33.44&lon=-94.04&appid=" + config.apiKey;
        let url = "http://localhost:8010/proxy/data/2.5/air_pollution?lat=" + lat2 + "&lon=" + long2 + "&appid=" + config.apiKey;

        fetch(url, requestOptions)
            .then(response => response.text())
            .then(result => parseAirPollutionOutput(result))
            .catch(error => console.log('error', error));
    }

    function parseAirPollutionOutput(input) {
        const output = JSON.parse(input);
        console.log(output);
        let aqi = output.list[0].main.aqi;
        document.getElementById("aqi").innerHTML = "Air quality index: " + aqi +
            "<br>AQI possible values: 1, 2, 3, 4, 5. 1 = Good, 2 = Fair, 3 = Moderate, 4 = Poor, 5 = Very Poor.";
        let co = output.list[0].components.co;
        document.getElementById("co").innerHTML = "Carbon Monoxide: " + co + " micrograms/cubic meter";
        let no = output.list[0].components.no;
        document.getElementById("no").innerHTML = "Nitrogen monoxide: " + no + " micrograms/cubic meter";
        let ozone = output.list[0].components.o3;
        document.getElementById("ozone").innerHTML = "Ozone: " + ozone + " micrograms/cubic meter";
    }

    function searchWeatherForecastByZipcode() {
        let zipcode = document.getElementById("zipcode").value;

        let myHeaders = new Headers();
        myHeaders.append('Access-Control-Allow-Origin', '');
        myHeaders.append("Accept", "/");

        let requestOptions = {
            method: 'GET',
            mode: 'cors',
            cache: 'no-cache',
            redirect: 'follow',
            referrerPolicy: 'no-referrer',
        };

        let url = "http://localhost:8010/proxy/data/2.5/forecast?zip=" + zipcode + "&appid=" + config.apiKey;

        fetch(url, requestOptions)
            .then(response => response.text())
            .then(result => convertJSONtoObject(JSON.parse(result).list))
            .catch(error => console.log('error', error));
    }

    function convertJSONtoObject(jsonArray) {
        //console.log("here convertJSONtoObject", jsonArray.length);
        let predictionArray = [];
        for (i = 0; i < 17; i++) {

            let predictionTimeFromJSON = new Date(jsonArray[i].dt * 1000).toLocaleString();
            let predictionTempFromJSON = Math.round(convertKelvinToFahrenheit(jsonArray[i].main.temp));
            let predictionDescriptionFromJSON = jsonArray[i].weather[0].description;

            //console.log("Jenny, " predictionTimeFromJSON, predictionTempFromJSON)
            const newObject = new Forecast(predictionTimeFromJSON, predictionTempFromJSON, predictionDescriptionFromJSON);
            predictionArray.push(newObject);
        }
        printToHTML(predictionArray);
    }

    function printToHTML(predictionArray) {
        let curSection = document.getElementById("forecast3");
        for (i = 0; i <= 17; i +=4) {

            let predictionTimeElem = document.createElement("h3");
            predictionTimeElem.innerHTML = "Forecast for: " + predictionArray[i]._predictionTime;
            let predictionTempElem = document.createElement("h3");
            predictionTempElem.innerHTML = "Temperature: " + predictionArray[i]._predictionTemp + " F";
            let predictionDescriptionElem = document.createElement("h3");
            predictionDescriptionElem.innerHTML = "Weather description: " + predictionArray[i]._predictionDescription;
            let newLineElem = document.createElement("hr");
            curSection.appendChild(predictionTimeElem);
            curSection.appendChild(predictionTempElem);
            curSection.appendChild(predictionDescriptionElem);
            curSection.appendChild(newLineElem);
        }
    }


</script>
</body>
</html>